//
//  GoWorkViewController.m
//  SubWay
//
//  Created by Gary on 14-4-25.
//  Copyright (c) 2014年 apple. All rights reserved.
//

#import "GoWorkViewController.h"

extern NSMutableArray *allStationArray;

@interface GoWorkViewController ()

@end

@implementation GoWorkViewController
@synthesize detailLabel,startTimeLabel,endTimeLabel;
@synthesize startView,endView,sc;
@synthesize startKuangImage1,startPlace1;
@synthesize startKuangImage2,endPlace2;
@synthesize array;


- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil
{
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
    }
    return self;
}

- (void)viewDidLoad
{
    [super viewDidLoad];
    d=[Dijkstra new];
    
    // Do any additional setup after loading the view from its nib.
    
    [_titleView setBackgroundColor:[UIColor colorWithRed:0.22 green:0.7 blue:0.76 alpha:0.9]];
    _StartEndVuew.layer.borderWidth = 1;
    _StartEndVuew.layer.borderColor = [[UIColor colorWithRed:0.22 green:0.7 blue:0.76 alpha:0.9] CGColor];
    _StartEndVuew.layer.cornerRadius =5;
    
    
    NSUserDefaults *defaults=[NSUserDefaults standardUserDefaults];
    _endLabel.text=[defaults objectForKey:@"company"];
    
    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(companyTextAction:) name:@"companyText" object:nil];//公司的位置改变通知
    
    detailLabel=[[UILabel alloc]initWithFrame:CGRectMake(20,170,self.view.frame.size.width-40,20)];
    detailLabel.backgroundColor=[UIColor clearColor];
    detailLabel.font=[UIFont systemFontOfSize:13];
    [self.view addSubview:detailLabel];
#pragma mark -scrollview
    {
        sc=[[UIScrollView alloc]initWithFrame:CGRectMake(0,190, self.view.frame.size.width, self.view.frame.size.height-190)];
        sc.showsVerticalScrollIndicator=NO;
        [sc setBackgroundColor:[UIColor clearColor]];
        [self.view addSubview:sc];
    }
    [self addView];
    
    if([CLLocationManager locationServicesEnabled])
    {
        if([CLLocationManager authorizationStatus] == kCLAuthorizationStatusDenied)
        {
            UIAlertView *alert=[[UIAlertView alloc]initWithTitle:@"提示" message:@"定位未开启" delegate:nil cancelButtonTitle:nil otherButtonTitles:@"确定", nil];
            [alert show];
            
            [sc setHidden:YES];
            detailLabel.frame=CGRectMake(20,220,self.view.frame.size.width-40,30);
            detailLabel.text=@"没有查询结果";
            detailLabel.textAlignment=NSTextAlignmentCenter;
        }
        else{
            locationManager = [[CLLocationManager alloc]init];
            locationManager.delegate = self;
            locationManager.desiredAccuracy=kCLLocationAccuracyBest;
            locationManager.distanceFilter = 100.0f;
            companyFlag=@"无";
            [locationManager startUpdatingLocation];
        }
    }
    else{
        NSLog(@"定位未开启。。。。。。。。。");
        UIAlertView *alert=[[UIAlertView alloc]initWithTitle:@"提示" message:@"定位未开启" delegate:nil cancelButtonTitle:nil otherButtonTitles:@"确定", nil];
        [alert show];
        
        [sc setHidden:YES];
        detailLabel.frame=CGRectMake(20,220,self.view.frame.size.width-40,30);
        detailLabel.textAlignment=NSTextAlignmentCenter;
        detailLabel.text=@"没有查询结果";
    }
    
    [sc setHidden:YES];
}
-(void)addView
{
    startTimeLabel=[[UILabel alloc]initWithFrame:CGRectMake(20,0, 200, 20)];
    startTimeLabel.text=@"首末班次 xx:xx";
    startTimeLabel.font=[UIFont systemFontOfSize:13];
    [sc addSubview:startTimeLabel];
    
    endTimeLabel=[[UILabel alloc]initWithFrame:CGRectMake(100,720, 200, 20)];
    endTimeLabel.text=@"首末班次 xx:xx";
    endTimeLabel.font=[UIFont systemFontOfSize:13];
    [sc addSubview:endTimeLabel];
    
    
    startView=[[UIView alloc]initWithFrame:CGRectMake(0,25, self.view.frame.size.width,20)];
    startView.backgroundColor=[UIColor redColor];
    [sc addSubview:startView];
    
    startKuangImage1=[[UIImageView alloc]initWithImage:[UIImage imageNamed:@"iPhone_kuang_0"]];
    startKuangImage1.frame=CGRectMake(60,-5,30,30);
    [startView addSubview:startKuangImage1];
    
    UILabel *start=[[UILabel alloc]initWithFrame:CGRectMake(0, 0, 30, 30)];
    start.text=@"起";
    start.backgroundColor=[UIColor clearColor];
    start.textAlignment=NSTextAlignmentCenter;
    start.textColor=[UIColor colorWithRed:0.11 green:0.42 blue:0.26 alpha:1];
    [startKuangImage1 addSubview:start];
    
    startPlace1=[[UILabel alloc]initWithFrame:CGRectMake(100, 0, 200,20)];
    startPlace1.font=[UIFont boldSystemFontOfSize:12];
    startPlace1.textColor=[UIColor whiteColor];
    startPlace1.backgroundColor=[UIColor clearColor];
    startPlace1.text=_startLabel.text;
    [startView addSubview:startPlace1];
    
    UIImageView *imageV=[[UIImageView alloc]initWithImage:[UIImage imageNamed:@"iPhone_btn_forward"]];
    imageV.frame=CGRectMake(startView.frame.size.width-40,0, 20, 20);
    [startView addSubview:imageV];
    
    endView=[[UIView alloc]initWithFrame:CGRectMake(0,sc.frame.size.height-25, self.view.frame.size.width,20)];
    endView.backgroundColor=[UIColor redColor];
    [sc addSubview:endView];
    
    
    startKuangImage2=[[UIImageView alloc]initWithImage:[UIImage imageNamed:@"iPhone_kuang_0"]];
    startKuangImage2.frame=CGRectMake(60,-5,30,30);
    [endView addSubview:startKuangImage2];
    
    UILabel *end=[[UILabel alloc]initWithFrame:CGRectMake(0,0, 30, 30)];
    end.text=@"终";
    end.backgroundColor=[UIColor clearColor];
    end.textAlignment=NSTextAlignmentCenter;
    end.textColor=[UIColor colorWithRed:0.11 green:0.42 blue:0.26 alpha:1];
    [startKuangImage2 addSubview:end];
    
    endPlace2=[[UILabel alloc]initWithFrame:CGRectMake(100,0, 200,20)];
    endPlace2.font=[UIFont boldSystemFontOfSize:12];
    endPlace2.textColor=[UIColor whiteColor];
    endPlace2.backgroundColor=[UIColor clearColor];
    endPlace2.text=_endLabel.text;
    [endView addSubview:endPlace2];

    UIImageView *imageV1=[[UIImageView alloc]initWithImage:[UIImage imageNamed:@"iPhone_btn_forward"]];
    imageV1.frame=CGRectMake(endView.frame.size.width-40,0, 20, 20);
    [endView addSubview:imageV1];
    
}
//通知
-(void)companyTextAction:(NSNotification *)nof
{
    _endLabel.text=[nof object];
    [[NSUserDefaults standardUserDefaults] setObject:[nof object] forKey:@"company"];
    [[NSUserDefaults standardUserDefaults]synchronize];
    [self query];
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (IBAction)backAction:(id)sender {
    [self dismissModalViewControllerAnimated:YES];
}

#pragma mark-locationManagerDelegate methods
- (void)locationManager:(CLLocationManager *)manager
    didUpdateToLocation:(CLLocation *)newLocation
           fromLocation:(CLLocation *)oldLocation
{
    
    NSString *lat = [[NSString alloc] initWithFormat:@"%f",[newLocation coordinate].latitude];
    NSString *lon = [[NSString alloc] initWithFormat:@"%f",[newLocation coordinate].longitude];
    
    CLGeocoder *myGecoder = [[CLGeocoder alloc] init];
    [myGecoder reverseGeocodeLocation:newLocation completionHandler:^(NSArray *placemarks, NSError *error)
     {
         if(error == nil && [placemarks count]>0)
         {
             CLPlacemark *placemark = [placemarks objectAtIndex:0];
             
             NSLog(@"Country = %@", placemark.country);
             NSLog(@"administrativeArea = %@",placemark.administrativeArea);
             NSLog(@"locality = %@", placemark.locality);
             NSLog(@"subLocality=%@",placemark.subLocality);
             NSLog(@"thoroughfare = %@", placemark.thoroughfare);
             NSLog(@"subThoroughfare=%@",placemark.subThoroughfare);
             
         }
         else if(error==nil && [placemarks count]==0)
         {
             NSLog(@"No results were returned.");
         }
         else if(error != nil)
         {
             NSLog(@"An error occurred = %@",error);
         }
     }];
    
    //更新定位信息方法
    NSLog(@"定位 经度%@,纬度%@",lat,lon);
    [locationManager stopUpdatingLocation];
    NSDictionary *dict=[[NSDictionary alloc]initWithObjectsAndKeys:lat,lon,nil];
    
    NSMutableDictionary *minDistanceDic=[[NSMutableDictionary alloc]init];
    
    for (int i=0; i<[allStationArray count]; i++)
    {
        if([[[allStationArray objectAtIndex:i] objectForKey:@"ZOPEN"]floatValue]==1)
        {
            //查询数据库得到
            float a= [[[allStationArray objectAtIndex:i] objectForKey:@"ZLATITUDE"] floatValue];
            float b= [[[allStationArray objectAtIndex:i] objectForKey:@"ZLONGITUDE"] floatValue];
            //定位得出的
            float c=[[[dict allValues] objectAtIndex:0] floatValue];
            float d1=[[[dict allKeys] objectAtIndex:0] floatValue];
            
            CLLocation *location=[[CLLocation alloc] initWithLatitude:a longitude:b];
            CLLocationDistance distance=[location distanceFromLocation:[[CLLocation alloc] initWithLatitude:c longitude:d1]];
            
            [minDistanceDic setValue:[NSNumber numberWithFloat:distance] forKey:[[allStationArray objectAtIndex:i]objectForKey:@"ZNAME"]];
        }
    }
    NSArray *ar=[minDistanceDic allValues];
    ar=[ar sortedArrayUsingComparator:^NSComparisonResult(id obj1, id obj2) {
        NSComparisonResult result = [obj1 compare:obj2];
        return result==NSOrderedDescending;
    }];
    [minDistanceDic enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) {
        float a=[obj floatValue];
        float b=[[ar objectAtIndex:0] floatValue];
        if(a==b)
        {
            if([companyFlag  isEqualToString:@"公司"])
            {
                _startLabel.text=key;
                _endLabel.text=key;
                [[NSUserDefaults standardUserDefaults] setObject:key forKey:@"company"];
                [[NSUserDefaults standardUserDefaults]synchronize];
                
                [self query];
                [sc setHidden:NO];
            }
            else
            {
                _startLabel.text=key;
                [self query];
                [sc setHidden:NO];
            }
        }
    }];
    
    if([_startLabel.text isEqualToString:_endLabel.text]){
        [sc setHidden:YES];
        detailLabel.frame=CGRectMake(20,220,self.view.frame.size.width-40,30);
        detailLabel.text=@"没有查询结果";
        detailLabel.textAlignment=NSTextAlignmentCenter;
    }
}

- (void)locationManager:(CLLocationManager *)manager
       didFailWithError:(NSError *)error
{
    //定位失败
    [locationManager stopUpdatingLocation];
}

- (IBAction)settingAction:(id)sender {
    UIActionSheet *action=[[UIActionSheet alloc]initWithTitle:@"修改公司的位置" delegate:self cancelButtonTitle:@"取消" destructiveButtonTitle:@"当前位置设为“公司" otherButtonTitles:@"自定义",@"清空设置", nil];
    [action showInView:self.view];
}

- (IBAction)moveAction:(id)sender
{
    NSString *start=_startLabel.text;
    NSString *end=_endLabel.text;
    
    _startLabel.text=end;
    _endLabel.text=start;
    if([_startLabel.text isEqualToString:_endLabel.text]){
        [sc setHidden:YES];
        detailLabel.frame=CGRectMake(20,220,self.view.frame.size.width-40,30);
        detailLabel.text=@"没有查询结果";
        detailLabel.textAlignment=NSTextAlignmentCenter;
    }
    else
    {
        [self query];
    }
}
#pragma mark actionSheet delegate
-(void)actionSheet:(UIActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex
{
    if(buttonIndex==0)
    {
        if([CLLocationManager locationServicesEnabled])
        {
            if([CLLocationManager authorizationStatus] == kCLAuthorizationStatusDenied)
            {
                UIAlertView *alert=[[UIAlertView alloc]initWithTitle:@"提示" message:@"定位未开启" delegate:nil cancelButtonTitle:nil otherButtonTitles:@"确定", nil];
                [alert show];
            }
            else
            {
                companyFlag=@"公司";
                [locationManager startUpdatingLocation];
            }
        }
        else
        {
            UIAlertView *alert=[[UIAlertView alloc]initWithTitle:@"提示" message:@"定位未开启" delegate:nil cancelButtonTitle:nil otherButtonTitles:@"确定", nil];
            [alert show];
        }
    }
    else if (buttonIndex==1)
    {
        SelectCompanyViewController *company=[[SelectCompanyViewController alloc]initWithNibName:IS_IPHONE5?@"SelectCompanyViewController_4":@"SelectCompanyViewController_3.5" bundle:nil];
        company.flag=@"1";
        [self presentModalViewController:company animated:YES];
    }
    else if (buttonIndex==2)
    {
        UIAlertView *alert=[[UIAlertView alloc]initWithTitle:@"提示" message:@"此操作会将原有的设置和数据进行清空，确定么？" delegate:self cancelButtonTitle:@"取消" otherButtonTitles:@"确定", nil];
        [alert show];
    }
}
#pragma mark -alert delegate
-(void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex
{
    if(buttonIndex==1){
        [[NSUserDefaults standardUserDefaults]removeObjectForKey:@"company"];
        [[NSUserDefaults standardUserDefaults] synchronize];
        
        MBProgressHUD *HUD = [[MBProgressHUD alloc] initWithView:self.view];
        [self.view.superview addSubview:HUD];
        HUD.labelText = @"清空成功";
        HUD.mode = MBProgressHUDModeText;
        [HUD showAnimated:YES whileExecutingBlock:^{
            sleep(2);
        } completionBlock:^{
            [HUD removeFromSuperview];
        }];
        [self dismissViewControllerAnimated:YES completion:^{
            
        }];
    }
}


-(void)query
{
    d->StrBegin=_startLabel.text;
    d->StrEnd=_endLabel.text;
    [d BuildGraph];
    
    sortPassStationArray=[[NSMutableArray alloc]init];
    for (NSString *str in [d.passStationArray reverseObjectEnumerator]) {
        [sortPassStationArray addObject:str];
    }
    if([sortPassStationArray count]>0){
        [sortPassStationArray removeObjectAtIndex:0];
    }
    
    [self getPlaces:sortPassStationArray];
    [sc setHidden:NO];
}
#pragma mark -计算出换乘站点
-(void)changeStation:(NSMutableArray *)palcesLineArray
{
    NSMutableArray *changeArray=[[NSMutableArray alloc]init];
    changeArray1=[[NSMutableArray alloc]init];
    
    for (int i=0;i<[palcesLineArray count];i++)
    {
        for (NSString *s in changeStationArray)
        {
            if([s isEqualToString:[palcesLineArray objectAtIndex:i]])
            {
                NSString *a;
                NSString *b;
                NSMutableArray *previousArray=[[NSMutableArray alloc] init];
                NSString *c;
                NSString *dd;
                NSMutableArray *nextArray=[[NSMutableArray alloc] init];
                
                //不是第一个站点
                if (i>=1){
                    NSArray *arrayA=[SqliteDao findLineByStationId:[palcesLineArray objectAtIndex:i-1]];
                    if(arrayA.count==1){
                        a=[[arrayA objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
                        [previousArray addObject:a];
                    }
                    if(arrayA.count>1)
                    {
                        a=[[arrayA objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
                        b=[[arrayA objectAtIndex:1]objectForKey:@"ZLINENUMBER"];
                        [previousArray addObject:a];
                        [previousArray addObject:b];
                    }
                    
                    NSLog(@"-%@--%@  %@号线",[palcesLineArray objectAtIndex:i-1],a,b);
                }
                if(i==0)
                {
                    NSArray *arrayA=[SqliteDao findLineByStationId:_startLabel.text];
                    if(arrayA.count==1){
                        a=[[arrayA objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
                        [previousArray addObject:a];
                    }
                    if(arrayA.count>1)
                    {
                        a=[[arrayA objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
                        b=[[arrayA objectAtIndex:1]objectForKey:@"ZLINENUMBER"];
                        [previousArray addObject:a];
                        [previousArray addObject:b];
                    }
                    NSLog(@"-%@--%@  %@号线",startPlace1.text,a,b);
                }
                
                //倒数第二个站点之前的
                if (i<palcesLineArray.count-1)
                {
                    NSArray *arrayB=[SqliteDao findLineByStationId:[palcesLineArray objectAtIndex:i+1]];
                    if(arrayB.count==1){
                        c=[[arrayB objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
                        [nextArray addObject:c];
                    }
                    if(arrayB.count>1)
                    {
                        c=[[arrayB objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
                        dd=[[arrayB objectAtIndex:1]objectForKey:@"ZLINENUMBER"];
                        [nextArray addObject:c];
                        [nextArray addObject:dd];
                    }
                    NSLog(@"-%@---%@  %@号线",[palcesLineArray objectAtIndex:i+1],c,dd);
                    
                }
                else{
                    NSArray *arrayB=[SqliteDao findLineByStationId:_endLabel.text];
                    if(arrayB.count==1){
                        c=[[arrayB objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
                        [nextArray addObject:c];
                    }
                    if(arrayB.count>1)
                    {
                        c=[[arrayB objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
                        dd=[[arrayB objectAtIndex:1]objectForKey:@"ZLINENUMBER"];
                        [nextArray addObject:c];
                        [nextArray addObject:dd];
                    }
                    NSLog(@"-%@----%@  %@号线",_endLabel.text,c,dd);
                }
                
                NSLog(@"previousArray:%@",previousArray);
                NSLog(@"nextArray:%@",nextArray);
                
                for (int i=0; i<nextArray.count; i++)
                {
                    
                    if(![previousArray containsObject:[nextArray objectAtIndex:i]])
                    {
                        [changeArray addObject:s];
                        NSLog(@"-----%@",s);
                    }
                    else if([previousArray containsObject:[nextArray objectAtIndex:i]])
                    {
                        i+=1;
                    }
                }
                
                
                
                
            }
        }
    }
    for (NSString *s in changeArray) {
        if([changeArray1 containsObject:s]==NO)
        {
            [changeArray1 addObject:s];
        }
    }
    
    for (NSString *s in changeArray1) {
        NSLog(@"换乘站点：%@",s);
    }
}
#pragma mark -列出路线
-(void)getPlaces:(NSMutableArray *)palcesLineArray
{
    for (UIView *s in [sc subviews]) {
        [s removeFromSuperview];
    }
    
    [self addView];
    [self changeStation:palcesLineArray];
    
    for (int i=0;i<[palcesLineArray count];i++)
    {
        //NSLog(@"-----列出路线----个数---%@----%i",[palcesLineArray objectAtIndex:i],palcesLineArray.count);
        if(i==0)
        {
            stationView=[[LineStationView alloc]initWithFrame:CGRectMake(0,40*i+50, sc.frame.size.width,40)];
            [sc addSubview:stationView];
            
            UIImageView *im=[[UIImageView alloc]initWithFrame:CGRectMake(0, 0, sc.frame.size.width,40)];
            im.backgroundColor=[UIColor clearColor];
            [stationView addSubview:im];
            
            UILabel *directionLabel=[[UILabel alloc]initWithFrame:CGRectMake(90,0,150,20)];
            directionLabel.backgroundColor=[UIColor clearColor];
            directionLabel.font=[UIFont systemFontOfSize:13];
            directionLabel.textColor=[UIColor grayColor];
            [im addSubview:directionLabel];
            
            [self direction:palcesLineArray];
            NSMutableArray *arrayLine=[[NSMutableArray alloc]init];
            if([[palcesLineArray objectAtIndex:0] hasSuffix:@"（未开通）"])
            {
                NSRange range=[[palcesLineArray objectAtIndex:0] rangeOfString:@"（"];
                NSString *str=[[palcesLineArray objectAtIndex:0] substringWithRange:NSMakeRange(0, range.location)];
                arrayLine=[SqliteDao findLineByStationId:str];//得出几号线
            }
            else
            {
                arrayLine=[SqliteDao findLineByStationId:[palcesLineArray objectAtIndex:0]];//得出几号线
            }
            
            if(arrayLine.count>0)
            {
                NSString *lineStr=[[arrayLine objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
                directionLabel.text=[NSString stringWithFormat:@"%@号线去往 %@ 方向",lineStr,direction];
            }
            
            UILabel *stationLabel=[[UILabel alloc]initWithFrame:CGRectMake(90,20, 150,20)];
            stationLabel.backgroundColor=[UIColor clearColor];
            stationLabel.textColor=[UIColor grayColor];
            stationLabel.font=[UIFont systemFontOfSize:13];
            stationLabel.text=[palcesLineArray objectAtIndex:i];
            [im addSubview:stationLabel];
            
            UIGraphicsBeginImageContext(im.frame.size);
            [im.image drawInRect:CGRectMake(0, 0, im.frame.size.width, im.frame.size.height)];
            CGContextRef context=UIGraphicsGetCurrentContext();
            CGContextSetLineWidth(context,1);
            CGContextSetRGBStrokeColor(context,0.0, 0.0, 0.0, 1.0);
            CGContextSetShouldAntialias(context, NO);
            CGContextBeginPath(context);
            CGContextMoveToPoint(context,75,0);
            CGContextAddLineToPoint(context,75,40);
            CGContextStrokePath(context);
            
            CGContextSetFillColorWithColor(context, [UIColor grayColor].CGColor);
            CGContextAddArc(context,75,30,3.5, 0,2*PI, 0);
            CGContextFillPath(context);
            
            im.image=UIGraphicsGetImageFromCurrentImageContext();
            UIGraphicsEndImageContext();
            
            for (NSString *s in changeArray1) {
                if([[palcesLineArray objectAtIndex:i] isEqualToString:s])
                {
                    NSMutableArray *startArray=[SqliteDao findLineByStationId:s];
                    
                    NSString *color=[[startArray objectAtIndex:0]objectForKey:@"ZCOLOR"];
                    color=[color substringWithRange:NSMakeRange(5, color.length-6)];
                    NSArray *colorArray=[color componentsSeparatedByString:@","];
                    
                    float red= ([colorArray[0] floatValue])/255;
                    float green= ([colorArray[1] floatValue])/255;
                    float blue= ([colorArray[2] floatValue])/255;
                    float alpha= ([colorArray[3] floatValue]);
                    im.backgroundColor=[UIColor colorWithRed:red green:green blue:blue alpha:alpha];
                    stationLabel.textColor=[UIColor whiteColor];
                }
                
            }
        }
        else
        {
            if(i==1)
            {
                stationView=[[LineStationView alloc]initWithFrame:CGRectMake(0,90, sc.frame.size.width,40)];
                [sc addSubview:stationView];
            }
            else if(i==2)
            {
                stationView=[[LineStationView alloc]initWithFrame:CGRectMake(0,130, sc.frame.size.width,40)];
                [sc addSubview:stationView];
            }
            else
            {
                stationView=[[LineStationView alloc]initWithFrame:CGRectMake(0,130+40*(i-2), sc.frame.size.width,40)];
                [sc addSubview:stationView];
            }
            UIImageView *im=[[UIImageView alloc]initWithFrame:CGRectMake(0, 0, sc.frame.size.width,40)];
            im.backgroundColor=[UIColor whiteColor];
            [stationView addSubview:im];
            
            UILabel *stationLabel=[[UILabel alloc]initWithFrame:CGRectMake(90,13, 150,20)];
            stationLabel.backgroundColor=[UIColor clearColor];
            stationLabel.textColor=[UIColor grayColor];
            stationLabel.font=[UIFont systemFontOfSize:13];
            stationLabel.text=[palcesLineArray objectAtIndex:i];
            
            [im addSubview:stationLabel];
            
            UIGraphicsBeginImageContext(im.frame.size);
            [im.image drawInRect:CGRectMake(0, 0, im.frame.size.width, im.frame.size.height)];
            CGContextRef context=UIGraphicsGetCurrentContext();
            CGContextSetLineWidth(context,1);
            CGContextSetRGBStrokeColor(context,0.0, 0.0, 0.0, 1.0);
            CGContextSetShouldAntialias(context, NO);
            CGContextBeginPath(context);
            CGContextMoveToPoint(context,75,0);
            CGContextAddLineToPoint(context,75,40);
            CGContextStrokePath(context);
            
            CGContextSetFillColorWithColor(context, [UIColor grayColor].CGColor);
            CGContextAddArc(context,75,22,3.5, 0,2*PI, 0);
            CGContextFillPath(context);
            
            im.image=UIGraphicsGetImageFromCurrentImageContext();
            UIGraphicsEndImageContext();
            for (NSString *s in changeArray1) {
                if([[palcesLineArray objectAtIndex:i] isEqualToString:s])
                {
                    NSMutableArray *startArray=[SqliteDao findLineByStationId:s];
                    
                    NSString *color=[[startArray objectAtIndex:0]objectForKey:@"ZCOLOR"];
                    color=[color substringWithRange:NSMakeRange(5, color.length-6)];
                    NSArray *colorArray=[color componentsSeparatedByString:@","];
                    
                    float red= ([colorArray[0] floatValue])/255;
                    float green= ([colorArray[1] floatValue])/255;
                    float blue= ([colorArray[2] floatValue])/255;
                    float alpha= ([colorArray[3] floatValue]);
                    im.backgroundColor=[UIColor colorWithRed:red green:green blue:blue alpha:alpha];
                    stationLabel.textColor=[UIColor whiteColor];
                }
                
            }
        }
    }
    LineStationView *stationV=[[LineStationView alloc]initWithFrame:CGRectMake(0,((palcesLineArray.count-1)*40)+90, sc.frame.size.width, 40)];
    [sc addSubview:stationV];
    
    UIImageView *im1=[[UIImageView alloc]initWithFrame:CGRectMake(0, 0, sc.frame.size.width, 40)];
    im1.backgroundColor=[UIColor clearColor];
    [stationV addSubview:im1];
    
    if(palcesLineArray.count==0)
    {
        UILabel *directionLabel=[[UILabel alloc]initWithFrame:CGRectMake(90,0,150,20)];
        directionLabel.backgroundColor=[UIColor clearColor];
        directionLabel.font=[UIFont systemFontOfSize:13];
        directionLabel.textColor=[UIColor grayColor];
        [im1 addSubview:directionLabel];
        
        [self direction:palcesLineArray];
        NSMutableArray *arrayLine=[SqliteDao findLineByStationId:_endLabel.text];//得出几号线
        if(arrayLine.count>0)
        {
            NSString *lineStr=[[arrayLine objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
            directionLabel.text=[NSString stringWithFormat:@"%@号线去往 %@ 方向",lineStr,direction];
        }
    }
    
    UIGraphicsBeginImageContext(im1.frame.size);
    [im1.image drawInRect:CGRectMake(0, 0, im1.frame.size.width, im1.frame.size.height)];
    CGContextRef context=UIGraphicsGetCurrentContext();
    CGContextSetLineWidth(context,1);
    CGContextSetRGBStrokeColor(context,0.0, 0.0, 0.0, 1.0);
    CGContextSetShouldAntialias(context, NO);
    CGContextBeginPath(context);
    CGContextMoveToPoint(context,75,0);
    CGContextAddLineToPoint(context,75,40);
    CGContextStrokePath(context);
    
    im1.image=UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    
    if(palcesLineArray.count>0)
        endView.frame=CGRectMake(0, sc.frame.origin.y+((palcesLineArray.count-1)*40)-50,CGRectGetWidth(self.view.frame), 20);
    else
        endView.frame=CGRectMake(0,95,CGRectGetWidth(self.view.frame), 20);
    
    endTimeLabel.frame=CGRectMake(20, endView.frame.origin.y+25,CGRectGetWidth(self.view.frame), 20);
    [sc setContentSize:CGSizeMake(0,((palcesLineArray.count-1)*40)+185)];
    
    
    detailLabel.frame=CGRectMake(20,170,self.view.frame.size.width-40,20);
    detailLabel.textAlignment=NSTextAlignmentLeft;
    
    NSMutableDictionary *ticketPriceDic=[SqliteDao findTicketPriceByStationId:_startLabel.text str:_endLabel.text];
    if(changeArray1.count==0)
        detailLabel.text=[NSString stringWithFormat:@"%i站\t\t\t%@元",d->length-1,[ticketPriceDic objectForKey:@"ZPRICE"]];
    else
        detailLabel.text=[NSString stringWithFormat:@"%i站，换乘%i次\t\t\t%@元",d->length-1,changeArray1.count,[ticketPriceDic objectForKey:@"ZPRICE"]];
    
    
    
    
    NSMutableDictionary *dictTime=[SqliteDao findStartAndEndTime1:startPlace1.text str:direction];
    if(dictTime.count==0)
    {
        NSMutableArray *arrayTime1=[SqliteDao findStartAndEndTime:startPlace1.text];
        if(arrayTime1.count==1)
            startTimeLabel.text=[NSString stringWithFormat:@"首末班次：%@/%@",[[arrayTime1 objectAtIndex:0] objectForKey:@"ZSTARTTIME"],[[arrayTime1 objectAtIndex:0] objectForKey:@"ZENDTIME"]];
        if(arrayTime1.count>1)
            startTimeLabel.text=[NSString stringWithFormat:@"首末班次：%@/%@",[[arrayTime1 objectAtIndex:1] objectForKey:@"ZSTARTTIME"],[[arrayTime1 objectAtIndex:1] objectForKey:@"ZENDTIME"]];
    }
    else
        startTimeLabel.text=[NSString stringWithFormat:@"首末班次：%@/%@",[dictTime objectForKey:@"ZSTARTTIME"],[dictTime objectForKey:@"ZENDTIME"]];
    
    NSMutableArray *arrayTime1=[SqliteDao findStartAndEndTime:_endLabel.text];
    if(arrayTime1.count==1)
        endTimeLabel.text=[NSString stringWithFormat:@"首末班次：%@/%@",[[arrayTime1 objectAtIndex:0] objectForKey:@"ZSTARTTIME"],[[arrayTime1 objectAtIndex:0] objectForKey:@"ZENDTIME"]];
    if(arrayTime1.count>1)
        endTimeLabel.text=[NSString stringWithFormat:@"首末班次：%@/%@",[[arrayTime1 objectAtIndex:1] objectForKey:@"ZSTARTTIME"],[[arrayTime1 objectAtIndex:1] objectForKey:@"ZENDTIME"]];
    
    
}
-(void)direction:(NSMutableArray *)palcesLineArray
{
    NSMutableArray *arrayLine=[[NSMutableArray alloc]init];
    
    if(palcesLineArray.count==0)
    {
        if([_endLabel.text hasSuffix:@"（未开通）"])
        {
            NSRange range=[_endLabel.text rangeOfString:@"（"];
            NSString *str=[_endLabel.text substringWithRange:NSMakeRange(0, range.location)];
            arrayLine=[SqliteDao findLineByStationId:str];//得出几号线
        }
        else
        {
            arrayLine=[SqliteDao findLineByStationId:_endLabel.text];//得出几号线
        }
        
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==1)
        {
            NSInteger a=[line1 indexOfObject:_startLabel.text];
            NSInteger b=[line1 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line1 lastObject];
            }
            else
            {
                direction=[line1 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==2)
        {
            NSInteger a=[line2 indexOfObject:_endLabel.text];
            NSInteger b=[line2 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line2 lastObject];
            }
            else
            {
                direction=[line2 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==3)
        {
            NSInteger a=[line3A indexOfObject:_startLabel.text];
            NSInteger b=[line3A indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line3A lastObject];
            }
            else
            {
                direction=[line3A firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==4)
        {
            NSInteger a=[line3B indexOfObject:_startLabel.text];
            NSInteger b=[line3B indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line3B lastObject];
            }
            else
            {
                direction=[line3B firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==5)
        {
            NSInteger a=[line4 indexOfObject:_startLabel.text];
            NSInteger b=[line4 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line4 lastObject];
            }
            else
            {
                direction=[line4 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==6)
        {
            NSInteger a=[line5 indexOfObject:_startLabel.text];
            NSInteger b=[line5 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line5 lastObject];
            }
            else
            {
                direction=[line5 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==10)
        {
            NSInteger a=[line6 indexOfObject:_startLabel.text];
            NSInteger b=[line6 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line6 lastObject];
            }
            else
            {
                direction=[line6 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==7)
        {
            NSInteger a=[line8 indexOfObject:_startLabel.text];
            NSInteger b=[line8 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line8 lastObject];
            }
            else
            {
                direction=[line8 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==8)
        {
            NSInteger a=[lineGF indexOfObject:_startLabel.text];
            NSInteger b=[lineGF indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[lineGF lastObject];
            }
            else
            {
                direction=[lineGF firstObject];
            }
        }
        
        
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==9)
        {
            NSInteger a=[lineAPM indexOfObject:_startLabel.text];
            NSInteger b=[lineAPM indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[lineAPM lastObject];
            }
            else
            {
                direction=[lineAPM firstObject];
            }
        }
    }
    else if(palcesLineArray.count==1)
    {
        if([[palcesLineArray objectAtIndex:0] hasSuffix:@"（未开通）"])
        {
            NSRange range=[[palcesLineArray objectAtIndex:0] rangeOfString:@"（"];
            NSString *str=[[palcesLineArray objectAtIndex:0] substringWithRange:NSMakeRange(0, range.location)];
            arrayLine=[SqliteDao findLineByStationId:str];//得出几号线
        }
        else
        {
            arrayLine=[SqliteDao findLineByStationId:[palcesLineArray objectAtIndex:0]];//得出几号线
        }
        
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==1)
        {
            NSInteger a=[line1 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line1 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line1 lastObject];
            }
            else
            {
                direction=[line1 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==2)
        {
            NSInteger a=[line2 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line2 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line2 lastObject];
            }
            else
            {
                direction=[line2 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==3)
        {
            NSInteger a=[line3A indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line3A indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line3A lastObject];
            }
            else
            {
                direction=[line3A firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==4)
        {
            NSInteger a=[line3B indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line3B indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line3B lastObject];
            }
            else
            {
                direction=[line3B firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==5)
        {
            NSInteger a=[line4 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line4 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line4 lastObject];
            }
            else
            {
                direction=[line4 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==6)
        {
            NSInteger a=[line5 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line5 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line5 lastObject];
            }
            else
            {
                direction=[line5 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==10)
        {
            NSInteger a=[line6 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line6 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line6 lastObject];
            }
            else
            {
                direction=[line6 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==7)
        {
            NSInteger a=[line8 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line8 indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[line8 lastObject];
            }
            else
            {
                direction=[line8 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==8)
        {
            NSInteger a=[lineGF indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[lineGF indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[lineGF lastObject];
            }
            else
            {
                direction=[lineGF firstObject];
            }
        }
        
        
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==9)
        {
            NSInteger a=[lineAPM indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[lineAPM indexOfObject:_endLabel.text];
            
            if (a<b) {
                direction=[lineAPM lastObject];
            }
            else
            {
                direction=[lineAPM firstObject];
            }
        }
    }
    else
    {
        if([[palcesLineArray objectAtIndex:0] hasSuffix:@"（未开通）"])
        {
            NSRange range=[[palcesLineArray objectAtIndex:0] rangeOfString:@"（"];
            NSString *str=[[palcesLineArray objectAtIndex:0] substringWithRange:NSMakeRange(0, range.location)];
            arrayLine=[SqliteDao findLineByStationId:str];//得出几号线
        }
        else
        {
            arrayLine=[SqliteDao findLineByStationId:[palcesLineArray objectAtIndex:0]];//得出几号线
        }
        
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==1)
        {
            NSInteger a=[line1 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line1 indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[line1 lastObject];
            }
            else
            {
                direction=[line1 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==2)
        {
            NSInteger a=[line2 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line2 indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[line2 lastObject];
            }
            else
            {
                direction=[line2 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==3)
        {
            NSInteger a=[line3A indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line3A indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[line3A lastObject];
            }
            else
            {
                direction=[line3A firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==4)
        {
            NSInteger a=[line3B indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line3B indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[line3B lastObject];
            }
            else
            {
                direction=[line3B firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==5)
        {
            NSInteger a=[line4 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line4 indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[line4 lastObject];
            }
            else
            {
                direction=[line4 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==6)
        {
            NSInteger a=[line5 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line5 indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[line5 lastObject];
            }
            else
            {
                direction=[line5 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==10)
        {
            NSInteger a=[line6 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line6 indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[line6 lastObject];
            }
            else
            {
                direction=[line6 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==7)
        {
            NSInteger a=[line8 indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[line8 indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[line8 lastObject];
            }
            else
            {
                direction=[line8 firstObject];
            }
        }
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==8)
        {
            NSInteger a=[lineGF indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[lineGF indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[lineGF lastObject];
            }
            else
            {
                direction=[lineGF firstObject];
            }
        }
        
        
        if([[[arrayLine objectAtIndex:0]objectForKey:@"ZLINEID"] integerValue]==9)
        {
            NSInteger a=[lineAPM indexOfObject:[palcesLineArray objectAtIndex:0]];
            NSInteger b=[lineAPM indexOfObject:[palcesLineArray objectAtIndex:1]];
            
            if (a<b) {
                direction=[lineAPM lastObject];
            }
            else
            {
                direction=[lineAPM firstObject];
            }
        }
    }
}
-(void)getLineAndColor:(NSString *)start str:(NSString *)end
{
    NSMutableArray *startArray=[SqliteDao findLineByStationId:start];
    NSMutableArray *endArray=[SqliteDao findLineByStationId:end];
    
    NSString *color=[[startArray objectAtIndex:0]objectForKey:@"ZCOLOR"];
    color=[color substringWithRange:NSMakeRange(5, color.length-6)];
    NSArray *colorArray=[color componentsSeparatedByString:@","];
    
    float red= ([colorArray[0] floatValue])/255;
    float green= ([colorArray[1] floatValue])/255;
    float blue= ([colorArray[2] floatValue])/255;
    float alpha= ([colorArray[3] floatValue]);
    startView.backgroundColor=[UIColor colorWithRed:red green:green blue:blue alpha:alpha];
    
    
    
    NSString *color1=[[endArray objectAtIndex:0]objectForKey:@"ZCOLOR"];
    color1=[color1 substringWithRange:NSMakeRange(5,color1.length-6)];
    NSArray *colorArray1=[color1 componentsSeparatedByString:@","];
    
    float red1= ([colorArray1[0] floatValue])/255;
    float green1= ([colorArray1[1] floatValue])/255;
    float blue1= ([colorArray1[2] floatValue])/255;
    float alpha1= ([colorArray1[3] floatValue]);
    endView.backgroundColor=[UIColor colorWithRed:red1 green:green1 blue:blue1 alpha:alpha1];
    
    NSString *startFlag=[[startArray objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
    if([startFlag isEqualToString:@"1"])
        startKuangImage1.image=[UIImage imageNamed:@"iPhone_kuang_0"];
    if([startFlag isEqualToString:@"2"])
        startKuangImage1.image=[UIImage imageNamed:@"iPhone_kuang_1"];
    if([startFlag isEqualToString:@"3"])
        startKuangImage1.image=[UIImage imageNamed:@"iPhone_kuang_2"];
    if([startFlag isEqualToString:@"4"])
        startKuangImage1.image=[UIImage imageNamed:@"iPhone_kuang_3"];
    if([startFlag isEqualToString:@"5"])
        startKuangImage1.image=[UIImage imageNamed:@"iPhone_kuang_4"];
    if([startFlag isEqualToString:@"6"])
        startKuangImage1.image=[UIImage imageNamed:@"iPhone_kuang_9"];
    if([startFlag isEqualToString:@"8"])
        startKuangImage1.image=[UIImage imageNamed:@"iPhone_kuang_6"];
    if([startFlag isEqualToString:@"APM"])
        startKuangImage1.image=[UIImage imageNamed:@"iPhone_kuang_8"];
    if([startFlag isEqualToString:@"GF"])
        startKuangImage1.image=[UIImage imageNamed:@"iPhone_kuang_7"];
    
    
    NSString *endFlag=[[endArray objectAtIndex:0]objectForKey:@"ZLINENUMBER"];
    if([endFlag isEqualToString:@"1"])
        startKuangImage2.image=[UIImage imageNamed:@"iPhone_kuang_0"];
    if([endFlag isEqualToString:@"2"])
        startKuangImage2.image=[UIImage imageNamed:@"iPhone_kuang_1"];
    if([endFlag isEqualToString:@"3"])
        startKuangImage2.image=[UIImage imageNamed:@"iPhone_kuang_2"];
    if([endFlag isEqualToString:@"4"])
        startKuangImage2.image=[UIImage imageNamed:@"iPhone_kuang_3"];
    if([endFlag isEqualToString:@"5"])
        startKuangImage2.image=[UIImage imageNamed:@"iPhone_kuang_4"];
    if([endFlag isEqualToString:@"6"])
        startKuangImage2.image=[UIImage imageNamed:@"iPhone_kuang_9"];
    if([endFlag isEqualToString:@"8"])
        startKuangImage2.image=[UIImage imageNamed:@"iPhone_kuang_6"];
    if([endFlag isEqualToString:@"APM"])
        startKuangImage2.image=[UIImage imageNamed:@"iPhone_kuang_8"];
    if([endFlag isEqualToString:@"GF"])
        startKuangImage2.image=[UIImage imageNamed:@"iPhone_kuang_7"];
    
}
@end
